<template>
	<el-row :gutter="10" style="margin: 0;padding: 0;margin-top: 1vh;">
		<el-col :span="18">
			<!-- 设备分布 -->
			<chartpanel title="" style="height: 92.5vh;position: relative;">
				<div style="position: absolute;top:1vh;width:100%;height: 91.5vh;">
					<div style="position: relative;height: 91.5vh;width: 99.5%">
						<div class="flex" >
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/1.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/2.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/3.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/4.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
						</div>
						<div style="width:100%;height:1vh"></div>
						<div class="flex" >
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/5.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/4.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/3.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/2.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
						</div>
						<div style="width:100%;height:1vh"></div>
						<div class="flex" >
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/4.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/3.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/5.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/1.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
						</div>
						<div style="width:1vh;height:1vh"></div>
						<div class="flex" >
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/2.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/1.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/2.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
							<div class="flex_item">
								<div class="device_item">
									<img src="@/assets/4.jpeg" style="width: 100%;height:100%;border-radius: 3px;">
									<div class="info">
										<div class="icon"><el-icon><VideoCamera /></el-icon></div>
										<div class="name">南门摄像头</div>
									</div>
								</div>
							</div>
							<div style="width:1vh;height:1vh"></div>
						</div>
					</div>
					
						<div class="chart_title" style="position: absolute;left:0;top:0;width:100%;text-align: center;">
							安防设分布</div>
				</div>
			</chartpanel>
		</el-col>
		<el-col :span="6">
			<!-- 设备类型统计 -->
			<chartpanel title="设备类型统计" style="height: 30vh;">
				<v-chart ref="typechart" style="min-height: 26vh;" :option="typechartoption"></v-chart>
			</chartpanel>
			<!-- 设备状态统计 -->
			<chartpanel title="设备状态统计" style="height: 30vh;margin-top: 1vh;">
				<v-chart ref="statuschart" style="min-height: 26vh;" :option="statuschartoption"></v-chart>
			</chartpanel>
			<!-- 设备告警统计 -->
			<chartpanel title="设备告警统计" style="height: 30vh;margin-top: 1vh;">
				<v-chart ref="alertchart" style="min-height: 26vh;" :option="alertchartoption"></v-chart>
			</chartpanel>
		</el-col>
	</el-row>
</template>

<script setup>
	import {
		ref,
		reactive,
		onMounted,
		onBeforeUnmount,
		computed
	} from 'vue'

	import VChart, {
		THEME_KEY
	} from "vue-echarts";

	import {
		Vue3SeamlessScroll
	} from "vue3-seamless-scroll";

	import config from '@/js/config.js'
	import utils from '@/js/utils.js'
	import chartutils from '@/js/chartutils.js'

	import * as echarts from 'echarts';
	import 'echarts-extension-amap';
	import 'echarts-wordcloud';
	import 'echarts-liquidfill';

	import Swiper from 'swiper';
	import 'swiper/dist/css/swiper.min.css';

	import chartpanel from '@/components/chartpanel.vue'

	const $echarts = echarts;

	//设备类型统计
	let typechart = ref();
	let typechartoption = reactive({});
	let typechartcategory = reactive(['摄像头','门禁','防盗门','闸道']);
	let typechartvalue = reactive([]);
	
	//状态
	let statuschart = ref();
	let statuschartoption = reactive({});
	let statuschartcategory = reactive(['正常','故障','告警','离线']);
	let statuschartvalue = reactive([]);
	
	//告警
	let alertchart = ref();
	let alertchartoption = reactive({});
	let alertchartcategory = reactive([]);
	let alertchartvalue = reactive([]);

	//初始化图标
	const initCharts = () => {
		typechartcategory.forEach((itme,index)=>{
			typechartvalue[index] = utils.random(1000);
		});
		chartutils.initPieFullChart(typechartoption,typechartcategory,typechartvalue);
		
		statuschartcategory.forEach((itme,index)=>{
			statuschartvalue[index] = utils.random(1000);
		});
		chartutils.initBarChart(statuschartoption,statuschartcategory,statuschartvalue,"#0bfdab");
		
		let date = new Date();
		date.setMonth(date.getMonth()-12);
		for (let i = new Date(date.getTime()); i.getTime() < new Date().getTime(); i.setMonth(i.getMonth()+1)) {
			alertchartcategory.push(i.format('MM-dd'));
			alertchartvalue.push(utils.random(1000));
		}
		// initLineChart: function(option, category, values, color)
		chartutils.initLineChart(alertchartoption,alertchartcategory,alertchartvalue,'#FF5252');
	}

	let timer = null;
	const startRefreshChart = () => {
		timer && clearInterval(timer);

		//获取刷新周期，TODO 配置变动时，此处需自动更新
		let refreshtime = 60 * 1000;
		config.getConfig().forEach(function(item, index) {
			if (item.key == 'refreshtime') {
				refreshtime = item.value;
			}
		});

		timer = setInterval(function() {
			typechartoption.series[0].data.forEach((item,index)=>{
				item.value = utils.random(1000);
			});
			
			statuschartvalue.forEach((item,index)=>{
				statuschartvalue[index] = utils.random(1000);
			})
			alertchartvalue.forEach((item,index)=>{
				alertchartvalue[index] = utils.random(1000);
			})
		}, refreshtime);
	}

	//挂
	onMounted(() => {
		initCharts();
		startRefreshChart();

		//图表尺寸自适应
		window.onresize = () => {
			typechart && typechart.value.resize();
			statuschart && statuschart.value.resize();
			alertchart && alertchart.value.resize();
		}
	});
	onBeforeUnmount(() => {
		timer && clearInterval(timer);
	});
</script>

<style scoped="scoped">
.device_item{
	width:100%;
	overflow: hidden;
	height: 22vh;
	position: relative;
	box-shadow: 0 0 0.5vh #11111122;
}
.device_item .info{
	position: absolute;
	left: 0;
	top:0;
	width:100%;
	height: 100%;
	background: #11111122;
	text-align: center;
	cursor: pointer;
	color: #fff;}
.device_item .info .icon{
	margin-top: 20%;
	font-size:3rem;
}
.device_item .info:hover{
	background: #00FAC144;
}
</style>
